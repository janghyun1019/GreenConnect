<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
    PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
    "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.app.dao.marketInfo.MarketInfoDAO">

    <!-- DB INSERT -->
    <insert id="insertMarketInfo" parameterType="com.app.dto.marketInfo.MarketInfoDTO">
        INSERT INTO MARKET_INFO
        (
            ID,
            GET_DATE,
            PUM_NM,
            G_NAME,
            AV_P,
            MI_P,
            MA_P,
            PAV_P,
            FLUC,
            U_NAME,
            D_MARK,
            J_7,
            J_7_MARK,
            S_POS_GUBUN,
            CREATED_AT
        )
        VALUES
        (
            MARKET_INFO_SEQ.NEXTVAL,
            #{getDate, jdbcType=VARCHAR},  -- 거래일자
            #{pumNm, jdbcType=VARCHAR},   -- 품목
            #{gName, jdbcType=VARCHAR},   -- 등급
            #{avP, jdbcType=INTEGER},     -- 평균가
            #{miP, jdbcType=INTEGER},     -- 최저가
            #{maP, jdbcType=INTEGER},     -- 최고가
            #{pavP, jdbcType=INTEGER},    -- 전일평균
            #{fluc, jdbcType=INTEGER},    -- 등락
            #{uName, jdbcType=VARCHAR},   -- 거래단위
            #{dMark, jdbcType=INTEGER},   -- 전일대비(%)
            #{j7, jdbcType=INTEGER},      -- 전7일평균
            #{j7Mark, jdbcType=INTEGER},  -- 전7일대비(%)
            #{sPosGubun, jdbcType=VARCHAR}, -- 시장구분
            SYSTIMESTAMP
        )
    </insert>

    <!-- 전체 목록 조회 -->
    <select id="selectAll" resultType="com.app.dto.marketInfo.MarketInfoDTO">
        SELECT
            ID,
            GET_DATE       AS getDate,
            PUM_NM         AS pumNm,
            G_NAME         AS gName,
            AV_P           AS avP,
            MI_P           AS miP,
            MA_P           AS maP,
            PAV_P          AS pavP,
            FLUC           AS fluc,
            U_NAME         AS uName,
            D_MARK         AS dMark,
            J_7            AS j7,
            J_7_MARK       AS j7Mark,
            S_POS_GUBUN    AS sPosGubun,
            CREATED_AT
        FROM MARKET_INFO
        ORDER BY GET_DATE DESC, ID DESC
    </select>

    <!-- 특정 날짜별 데이터 조회 -->
    <select id="selectByDate" parameterType="String" resultType="com.app.dto.marketInfo.MarketInfoDTO">
        SELECT
            ID,
            GET_DATE       AS getDate,
            PUM_NM         AS pumNm,
            G_NAME         AS gName,
            AV_P           AS avP,
            MI_P           AS miP,
            MA_P           AS maP,
            PAV_P          AS pavP,
            FLUC           AS fluc,
            U_NAME         AS uName,
            D_MARK         AS dMark,
            J_7            AS j7,
            J_7_MARK       AS j7Mark,
            S_POS_GUBUN    AS sPosGubun,
            CREATED_AT
        FROM MARKET_INFO
        WHERE GET_DATE = #{getDate}
        ORDER BY ID DESC
    </select>

    <!-- 최신 데이터 조회 -->
    <select id="selectLatest" resultType="com.app.dto.marketInfo.MarketInfoDTO">
        SELECT *
        FROM MARKET_INFO
        WHERE GET_DATE = (SELECT MAX(GET_DATE) FROM MARKET_INFO)
        ORDER BY ID DESC
    </select>

</mapper>
